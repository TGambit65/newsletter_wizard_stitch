# PRD 4.3 — Global Search

**Phase:** 4 — Growth and Engagement
**Type:** NEW
**Complexity:** High
**Dependencies:** Task 1.2 (Dialog for command palette), existing RAG infrastructure

---

## Goal

Let users find any content across the platform instantly via a unified search interface.

---

## Target User

Active user with 10+ newsletters and 20+ knowledge sources who needs to find specific content quickly.

---

## Success Metrics

- Search usage > 5 searches per active user per week
- Cmd+K adoption > 30% of all searches
- Result click-through rate > 60%

---

## Features

### 1. Command Palette (Cmd/Ctrl+K)
- Full-screen overlay accessible from any page
- Text input with instant results as you type
- Arrow keys to navigate, Enter to select, Escape to close
- Recent searches shown when input is empty
- Keyboard shortcut indicator in header bar

### 2. Dedicated Search Page (`/search`)
- Full result grid with faceted filters
- Shareable URLs with search state in query params
- Handles deeper browsing and bulk result scanning

### 3. AI Semantic Search
- Natural language queries leveraging existing RAG embeddings
- "What did I write about React hooks?" finds relevant content
- Falls back to text search if semantic search returns no results

### 4. Faceted Results
Filter by:
- **Type**: Newsletter, Knowledge Source, Template
- **Status**: Draft, Scheduled, Sent, Published
- **Date range**: Last 7 days, 30 days, 90 days, Custom

### 5. Smart Suggestions
- AI-suggested related queries
- "Quick add" from search results (e.g., "Add this source to KB")
- "Did you mean?" for near-matches

### 6. Empty States
- Search tips displayed when no results
- Suggested popular queries for new users
- Direct CTA to create content if nothing exists yet

---

## Backend Design

### Edge Function: `global-search`

**Input:**
```json
{
  "tenant_id": "...",
  "query": "React performance tips",
  "filters": {
    "types": ["newsletter", "source"],
    "date_range": { "from": "2025-01-01", "to": "2025-12-31" },
    "status": ["sent", "draft"]
  },
  "limit": 20
}
```

**Output:**
```json
{
  "results": [
    {
      "type": "newsletter",
      "id": "...",
      "title": "React Performance Tips",
      "snippet": "...hooks and memoization...",
      "relevance": 0.92,
      "date": "2025-06-01",
      "status": "sent"
    }
  ],
  "suggestions": ["React hooks optimization", "useCallback vs useMemo"]
}
```

**Search strategy:**
1. Text search across `newsletters.title`, `newsletters.content_html`, `knowledge_sources.title`, `knowledge_sources.description`
2. Semantic search via existing `rag-search` for source chunk content
3. Merge, deduplicate, and rank by relevance × recency

---

## Out of Scope

- Search analytics (what users are searching for)
- Saved searches / search history persistence
- Search within newsletter HTML content (full-text indexed)
- Real-time search indexing

---

## Implementation Subtasks

- [ ] 4.3.1: Create `pages/SearchPage.tsx` with search input, filter sidebar, result grid
- [ ] 4.3.2: Create `components/ui/CommandPalette.tsx` with keyboard navigation and recent searches
- [ ] 4.3.3: Add global `keydown` listener in `DashboardLayout` for Cmd/Ctrl+K
- [ ] 4.3.4: Create edge function `global-search` (spec above)
- [ ] 4.3.5: Build faceted filter UI — type pills, date range picker, status dropdown
- [ ] 4.3.6: Build result cards — type badge, title, snippet, date, "Open" action
- [ ] 4.3.7: Build empty state with search tips and suggested queries
- [ ] 4.3.8: Add shared types: `SearchResult`, `SearchRequest` in `packages/shared`
- [ ] 4.3.9: Add `api.ts` wrapper: `globalSearch()`
- [ ] 4.3.10: Add route `/search` in App.tsx
- [ ] 4.3.11: Add search icon to header bar in `DashboardLayout` (opens command palette)
- [ ] 4.3.12: Mobile: command palette becomes full-screen search overlay

---

## Stitch Design References

`search:_ai_semantic_search`, `search:_results_&_filters`, `search:_visual_discovery`, `search:_ai_suggestions_empty_state`
