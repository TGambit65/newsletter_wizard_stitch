# PRD 3.6 — Template Library

**Phase:** 3 — Core Product Features
**Type:** NEW
**Complexity:** High
**Dependencies:** Task 1.4 (Pagination), Task 3.3 (Navigation update)

---

## Goal

Reduce time-to-first-newsletter by providing ready-to-use templates that match common newsletter objectives.

---

## Target User

New or returning user who wants to create a newsletter but does not want to start from scratch.

---

## Success Metrics

- 40%+ of new newsletters created from templates within 30 days of feature launch
- Template users reach "sent" status 2× faster than blank-start users
- NPS score for template quality > 70

---

## Features

### 1. Visual Categories
Card grid browsable by category:
- Promotional
- Educational
- Curated
- Company Update
- Product Launch
- Event Recap

### 2. AI Recommendations
"Recommended for you" section personalized by past newsletter topics and engagement.

### 3. Performance-Based Ranking
Templates sorted by avg open/click rate of newsletters created from them.

### 4. Goal-Oriented Selection
Filter by objective:
- Grow subscribers
- Drive clicks
- Re-engage
- Inform

### 5. Preview and Use
Click template → full-content preview modal → "Use this template" creates new newsletter prefilled with template content.

---

## Data Model

```sql
CREATE TABLE newsletter_templates (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  description TEXT,
  category TEXT NOT NULL,
  goal_tags TEXT[] DEFAULT '{}',
  content_html TEXT NOT NULL,
  content_json JSONB,
  thumbnail_url TEXT,
  is_system BOOLEAN DEFAULT true,
  tenant_id UUID REFERENCES tenants(id),
  usage_count INTEGER DEFAULT 0,
  avg_open_rate DECIMAL(5,2),
  avg_click_rate DECIMAL(5,2),
  created_at TIMESTAMPTZ DEFAULT now()
);

ALTER TABLE newsletters ADD COLUMN template_id UUID REFERENCES newsletter_templates(id);
```

**Seed data:** 12 system templates covering all categories.

---

## Edge Function: `recommend-templates`

**Input:** `{ tenant_id }`
**Output:** Ranked template IDs based on tenant's newsletter history topics and engagement.

---

## Out of Scope

- Template editor / builder (drag-and-drop customization)
- Custom template creation by users (v2)
- Template sharing between tenants

---

## Implementation Subtasks

- [ ] 3.6.1: Create DB migration: `newsletter_templates` table + `template_id` column on `newsletters`
- [ ] 3.6.2: Create seed data: 12 system templates with HTML content, descriptions, categories, goal tags
- [ ] 3.6.3: Add shared types: `NewsletterTemplate` interface in `packages/shared`
- [ ] 3.6.4: Create `pages/TemplatesPage.tsx` with category filter tabs, goal filter pills, and card grid
- [ ] 3.6.5: Build template preview modal (using Dialog) — full HTML preview + metadata
- [ ] 3.6.6: Build "Use this template" flow — creates new newsletter with `template_id`, prefilled content
- [ ] 3.6.7: Create edge function `recommend-templates`
- [ ] 3.6.8: Build "Recommended for you" section consuming recommendation API
- [ ] 3.6.9: Build performance sorting — query aggregated stats of newsletters using each template
- [ ] 3.6.10: Add `api.ts` wrappers: `getTemplates()`, `recommendTemplates()`, `useTemplate()`
- [ ] 3.6.11: Add route `/templates` in App.tsx, add to sidebar navigation
- [ ] 3.6.12: Add pagination (Task 1.4) for template grid
- [ ] 3.6.13: Mobile responsive — 1-column on mobile, 2-column on tablet, 3+ on desktop
- [ ] 3.6.14: Add empty state for categories with no templates

---

## Stitch Design References

`templates:_visual_categories_v1`, `templates:_ai_recommendations_v2`, `templates:_performance_list_v3`, `templates:_goal-oriented_v4`
