# PRD 3.5 — Newsletter Preview: Multi-Device and Accuracy Check

**Phase:** 3 — Core Product Features
**Type:** EXPAND
**Complexity:** Medium
**Dependencies:** Task 0.1 (HTML sanitization), Task 1.2 (Dialog), Task 2.2 (Editor refactor)

---

## Goal

Give newsletter authors confidence their content looks good and reads well across all devices and email clients before sending.

---

## Target User

Newsletter author in the editor who is about to send or schedule.

---

## Success Metrics

- Preview usage rate > 60% before send
- Quality check adoption > 30% of previews
- Reduction in post-send "it looks broken on mobile" complaints

---

## Features

### 1. Multi-Device Toggle
Desktop (650px), Tablet (480px), and Mobile (375px) preview frames with realistic device chrome borders.

### 2. Campaign View
Full inbox simulation showing:
- From name
- Subject line
- Preheader
- Email body

### 3. Accuracy Check (AI Scoring)
| Check | Description |
|-------|-------------|
| Readability | Flesch-Kincaid score |
| Spam words | Detection of common spam trigger words |
| Link validation | Verify hrefs exist and are not broken |
| Image alt text | Flag missing alt attributes |
| Subject length | Warn if > 50 characters |
| Overall grade | A–F composite score |

### 4. Fix Issues
Auto-correct button for addressable issues:
- Add placeholder alt text to images
- Flag subject line length with suggested trim
- Highlight broken links

---

## Out of Scope

- Actual email client rendering (Litmus-style cross-client testing)
- A/B test variant preview
- Dark mode email preview

---

## Edge Function: `check-newsletter-quality`

**Input:**
```json
{
  "content_html": "...",
  "subject_line": "...",
  "preheader": "..."
}
```

**Output:**
```json
{
  "readability_score": 72,
  "spam_score": 0.1,
  "broken_links": [],
  "missing_alt_text": ["img#3", "img#7"],
  "subject_length_ok": true,
  "overall_grade": "B"
}
```

---

## Implementation Subtasks

- [ ] 3.5.1: Redesign preview modal as full-screen Dialog with device frame selector
- [ ] 3.5.2: Build device frame component: CSS borders/shadows simulating desktop/tablet/mobile chrome
- [ ] 3.5.3: Build campaign view: From/Subject/Preheader header above content, inbox-style rendering
- [ ] 3.5.4: Create edge function `check-newsletter-quality` (spec above)
- [ ] 3.5.5: Build quality check panel in preview modal — scores with colored indicators
- [ ] 3.5.6: Build "Fix issues" button — auto-add alt text placeholders, flag long subject line
- [ ] 3.5.7: Add `api.ts` wrapper: `checkNewsletterQuality()`
- [ ] 3.5.8: Sanitize all HTML in preview (uses Task 0.1 utility)
- [ ] 3.5.9: Mobile responsive — device toggle switches to vertical stack on small screens
- [ ] 3.5.10: Test with various HTML newsletter layouts

---

## Stitch Design References

`preview:_multi-device_toggle`, `preview:_accuracy_check`, `preview:_campaign_view`, `preview:_final_review_v1`
